<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ajax | blog</title>
  <meta name="keywords" content="">
  <meta name="description" content="Ajax | blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote s">
<meta property="og:type" content="article">
<meta property="og:title" content="10.测试">
<meta property="og:url" content="http://yoursite.com/2022/03/27/10.%E6%B5%8B%E8%AF%95/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:description" content="Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote s">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-03-27T09:16:57.553Z">
<meta property="article:modified_time" content="2022-03-27T09:16:57.553Z">
<meta property="article:author" content="wangweilin">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>wangweilin</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/WilliamWang106" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="weibo" href="http://weibo.com/u/2307534817" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-weibo"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:627516754@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=627516754&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(10)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="10">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">王伟霖</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class=""
           href="/2017/03/01/1-HTML%E5%9F%BA%E7%A1%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="HTML基础测试修改">HTML基础测试修改</span>
            <span class="post-date" title="2017-03-01 09:45:52">2017/03/01</span>
        </a>
        
        <a  class=""
           href="/2022/03/27/10.%E6%B5%8B%E8%AF%95/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="10.测试">10.测试</span>
            <span class="post-date" title="2022-03-27 17:16:57">2022/03/27</span>
        </a>
        
        <a  class=""
           href="/2017/03/05/3.JS%E5%9F%BA%E7%A1%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JS基础">JS基础</span>
            <span class="post-date" title="2017-03-05 15:40:32">2017/03/05</span>
        </a>
        
        <a  class=""
           href="/2017/03/05/2-%E7%A7%BB%E5%8A%A8WEB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="移动WEB">移动WEB</span>
            <span class="post-date" title="2017-03-05 12:42:32">2017/03/05</span>
        </a>
        
        <a  class=""
           href="/2017/03/23/4.DOM/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JS-DOM">JS-DOM</span>
            <span class="post-date" title="2017-03-23 10:43:12">2017/03/23</span>
        </a>
        
        <a  class=""
           href="/2017/05/12/5.jQuery/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="jQuery">jQuery</span>
            <span class="post-date" title="2017-05-12 13:43:02">2017/05/12</span>
        </a>
        
        <a  class=""
           href="/2017/03/28/6.JS%E9%AB%98%E7%BA%A7/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JS-高级">JS-高级</span>
            <span class="post-date" title="2017-03-28 00:00:00">2017/03/28</span>
        </a>
        
        <a  class=""
           href="/2018/03/19/8.git-material/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="git">git</span>
            <span class="post-date" title="2018-03-19 00:00:00">2018/03/19</span>
        </a>
        
        <a  class=""
           href="/2017/05/18/7.ajax/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Ajax">Ajax</span>
            <span class="post-date" title="2017-05-18 00:00:00">2017/05/18</span>
        </a>
        
        <a  class=""
           href="/2018/08/20/9.ES6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="ES6">ES6</span>
            <span class="post-date" title="2018-08-20 19:32:19">2018/08/20</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-7.ajax" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Ajax</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <!-- <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2022-03-27 17:16:57'>2017-05-18 00:00</time>
        
    </div> -->
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AJAX"><span class="toc-text">AJAX</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#预备知识"><span class="toc-text">预备知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器与客户端的概念"><span class="toc-text">服务器与客户端的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web请求与响应"><span class="toc-text">web请求与响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http协议"><span class="toc-text">http协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小黑窗服务器的使用"><span class="toc-text">小黑窗服务器的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启动"><span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让你的网页让别人访问"><span class="toc-text">让你的网页让别人访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提供数据"><span class="toc-text">提供数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#理解接口"><span class="toc-text">理解接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问接口。"><span class="toc-text">访问接口。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JQuery中的ajax"><span class="toc-text">JQuery中的ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个ajax请求"><span class="toc-text">第一个ajax请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ajax基本使用"><span class="toc-text">$.ajax基本使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ajax中的回调函数"><span class="toc-text">ajax中的回调函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#案例-留言板"><span class="toc-text">案例-留言板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果演示及分析"><span class="toc-text">效果演示及分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#留言板-获取留言"><span class="toc-text">留言板-获取留言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#留言板-添加留言"><span class="toc-text">留言板-添加留言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#作业"><span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#认识ajax"><span class="toc-text">认识ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AJAX的应用场景"><span class="toc-text">AJAX的应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AJAX是什么"><span class="toc-text">AJAX是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AJAX的优点"><span class="toc-text">AJAX的优点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同步异步"><span class="toc-text">同步异步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#理解同步异步"><span class="toc-text">理解同步异步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ajax中的同步异步"><span class="toc-text">ajax中的同步异步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ajax与http协议"><span class="toc-text">ajax与http协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ajax请求与普通请求"><span class="toc-text">ajax请求与普通请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ajax与接口"><span class="toc-text">ajax与接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原生ajax"><span class="toc-text">原生ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个原生ajax"><span class="toc-text">第一个原生ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#原生ajax基本格式"><span class="toc-text">原生ajax基本格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求方式"><span class="toc-text">请求方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#原生ajax发get请求"><span class="toc-text">原生ajax发get请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原生ajax发post请求"><span class="toc-text">原生ajax发post请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get和post的区别"><span class="toc-text">get和post的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其它请求方式"><span class="toc-text">其它请求方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理服务器的返回值"><span class="toc-text">处理服务器的返回值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#三种格式的字符串"><span class="toc-text">三种格式的字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON字符串"><span class="toc-text">JSON字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#如何判断返回值是JSON字符串"><span class="toc-text">如何判断返回值是JSON字符串</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON是什么"><span class="toc-text">JSON是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON字符串相关的两个操作"><span class="toc-text">JSON字符串相关的两个操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-stringify"><span class="toc-text">JSON.stringify</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-parse"><span class="toc-text">JSON.parse</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML字符串（简单了解）"><span class="toc-text">XML字符串（简单了解）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML-和-JSON"><span class="toc-text">XML 和 JSON</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ie兼容性问题"><span class="toc-text">ie兼容性问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#onreadystatechange及ajax状态码"><span class="toc-text">onreadystatechange及ajax状态码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xhr-对象的状态"><span class="toc-text">xhr 对象的状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ie浏览器对get类型接口缓存问题"><span class="toc-text">ie浏览器对get类型接口缓存问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ajax异常处理"><span class="toc-text">ajax异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ajax处理"><span class="toc-text">ajax处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FormData对象"><span class="toc-text">FormData对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#快速获取表单中的元素值"><span class="toc-text">快速获取表单中的元素值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FormData对象的api"><span class="toc-text">FormData对象的api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件上传"><span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#onprogress事件"><span class="toc-text">onprogress事件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原生ajax封装"><span class="toc-text">原生ajax封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#封装1-命名"><span class="toc-text">封装1-命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装2-提取type参数"><span class="toc-text">封装2-提取type参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装3-提取url和data"><span class="toc-text">封装3-提取url和data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装4-处理post请求"><span class="toc-text">封装4-处理post请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装5-处理回调函数"><span class="toc-text">封装5-处理回调函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第7章-主流ajax库"><span class="toc-text">第7章 主流ajax库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第1节-jquery"><span class="toc-text">第1节 jquery</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ajax"><span class="toc-text">$.ajax</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ajax方法的简便用法"><span class="toc-text">$.ajax方法的简便用法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#get的格式"><span class="toc-text">$.get的格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#post的格式"><span class="toc-text">$.post的格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getJSON"><span class="toc-text">$.getJSON</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios库"><span class="toc-text">axios库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用示例"><span class="toc-text">使用示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#案例-会员管理系统"><span class="toc-text">[案例]会员管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#演示及分析"><span class="toc-text">演示及分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显示会员列表"><span class="toc-text">显示会员列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看会员详情"><span class="toc-text">查看会员详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除会员"><span class="toc-text">删除会员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加会员"><span class="toc-text">添加会员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#文件控件"><span class="toc-text">文件控件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#本地图片预览"><span class="toc-text">本地图片预览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#整体实现"><span class="toc-text">整体实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下拉加载"><span class="toc-text">下拉加载</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h1><p>ajax是前端开发人员必须掌握的技能。它并不是一项新技术，应该说是一个比较老的技术了(1998 年就开始使用了)，它主要用于发送异步请求进行页面的局部更新，以提升用户体验。在目前前后端分离开发的大趋势下，ajax成为了前端人员与后端人员交流的手段，分工合作的基础。 </p>
<p>课程整体说明</p>
<p>我们前一个阶段的学习内容主要是在做<strong>静态页面</strong>,注意放在css,dom操作上，它们的目标是让你能够还原设计师对网站的需求，在此阶段，有两个缺点：</p>
<ul>
<li>网页只能自己看看，无法共享给其它人查看。</li>
<li>页面中的数据都是死的，没有活数据。</li>
</ul>
<p>这个AJAX阶段，我们引入服务器和ajax的概念来解决这两个问题。</p>
<ul>
<li>通过ajax技术从web服务器上获取活数据</li>
<li>使用虚拟web服务器，让其它同学也可以访问我们的网页</li>
</ul>
<p>目标: </p>
<ul>
<li><p>建立起服务器，客户端的概念</p>
</li>
<li><p>能使用第三方的ajax库：jquery，axios；</p>
</li>
<li><p>能手写ajax</p>
</li>
</ul>
<p>整体案例展示：</p>
<ul>
<li>留言板</li>
<li>会员管理系统<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><h3 id="服务器与客户端的概念"><a href="#服务器与客户端的概念" class="headerlink" title="服务器与客户端的概念"></a>服务器与客户端的概念</h3></li>
</ul>
<p><strong>服务器(server)</strong></p>
<p>服务器是为其它设备提供服务的机器。我们可以理解：</p>
<blockquote>
<p>服务器 = 硬件配置高的电脑 + 安装特殊软件</p>
</blockquote>
<p>它之所以能够提供服务，一方面是硬件性能比较强，另一方面是因为安装了一些特殊的软件：</p>
<ul>
<li>web服务器： 安装了能提供<code>web服务</code>的软件。如iis, nginx, apache等。</li>
<li>ftp服务器：装了ftp软件，提供文件上传下载服务。</li>
<li>数据库服务器：安装了mysql,sql server,mongodb等软件，能够提供数据库服务。</li>
</ul>
<p>有两点要注意：</p>
<ol>
<li>一台服务器可以安装多个软件，来提供多种服务。</li>
<li>服务器是一个相对的概念：如果某台计算机在某个时间给其它设置提供了某个服务，则可以称为它是充当了服务器的功能。例如，你的手机开了热点，别的同学可以通过你的手机来上网，则此时，也可以说你的手机就是一台wifi服务器。</li>
</ol>
<p><strong>客户端（client)</strong><br>连接到服务器，享受服务的设备，就是客户端。一般来说，要<strong>享受某个服务也是需要安装一些软件</strong>的。例如：要想看电影：需要安装爱奇艺客户端软件（或者是通过浏览器软件来访问它的网站）。</p>
<p>在给大家演示留言板的功能时，我的计算机就充当了服务器的角色，而大家的电脑就是享受这个服务的客户端。</p>
<p>要注意这里有两个细节：</p>
<ol>
<li>服务器之所以能提供服务，是因为它安装了<code>特殊软件</code>，客户端之所以享受服务，也是因为它安装了某些软件。</li>
<li>服务器与客户端是相对的：你也可以把自己的电脑中安装软件器软件，让它也能够为其它同学提供服务。</li>
</ol>
<h3 id="web请求与响应"><a href="#web请求与响应" class="headerlink" title="web请求与响应"></a>web请求与响应</h3><p>我们把<strong>服务器</strong>与<strong>客户端</strong>这两个概念具体到<strong>web服务器</strong>与<strong>浏览器</strong>上来。web服务器就是能提供web服务的服务器，在客户端中，我们要安装浏览器来访问web服务器。</p>
<p>在我们上网的过程中，一般来讲是:</p>
<ul>
<li>客户端浏览器主动向web服务器发送请求（可能是通过在浏览器地址栏中直接输入地址，或者是点击了某个超链接）</li>
<li>web服务器收到请求之后将用户需要的请求进行返回。</li>
</ul>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94.png" alt="1568438905809"></p>
<p>基本流程</p>
<ol>
<li>确认地址。用户在浏览器（客户端）地址栏输入要访问的网站网址（URL）</li>
<li>发送请求。浏览器向服务器发送请求(request)，告知服务器要获取的内容</li>
<li>获取响应。服务端收到浏览器发送的请求，并把处理的结果返回给浏览器(response)</li>
<li>显示内容。浏览器将服务端返回的结果显示到界面上</li>
</ol>
<p>操作</p>
<ul>
<li>在network面板中观察请求</li>
</ul>
<p>注意：<br>如果一个html文件中还引用其它的文件：如样式文件,js文件,图片文件，则会发出多次请求。</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E5%A4%9A%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94.png" alt="1568438967251"></p>
<h3 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h3><p>浏览器与web服务器之间的请求与响应过程是遵守一定的规则的，浏览器向服务器请求什么内容，以什么方式发请求，服务器如何处理这些请求，返回的内容格式是什么，这些细节都有具体的约定，这就是我们要学习的http协议。</p>
<ul>
<li>http(Hypertext transfer protocol)超文本传输协议。</li>
<li>协议 就是规定，就像本朝的法律，必须遵守。</li>
<li>http协议的双方就是浏览器和web服务器。http协议规定了通过浏览器和服务器进行数据交互，进行超文本（文本、图片、视频等）传输的规定。<br><img src="ajax_%E8%AE%B2%E4%B9%89.assets/http%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt="1573444145404"></li>
</ul>
<h2 id="小黑窗服务器的使用"><a href="#小黑窗服务器的使用" class="headerlink" title="小黑窗服务器的使用"></a>小黑窗服务器的使用</h2><p>为了方便学习，我们会在自己的电脑上安装web服务器软件，把自己的电脑虚拟成web服务器。换句话说，我们的电脑既是客户端，又是服务器。</p>
<p>我们可以安装一些第三方的web服务器软件例如:apache,nginx,iis等。但是为了后期学习的方便，我们这里是使用nodejs写了一个简单的web服务器，通过它我们就可以体现web服务器的功能了。目前来说，我们不用关心它的具体实现，而只需要学会如何使用它就行了。</p>
<p>基本步骤：</p>
<ul>
<li>下载并安装<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">nodejs</a></li>
<li>启动小黑窗服务器</li>
</ul>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>你可以把这个文件夹放置在你电脑的任意位置。</p>
<img src="ajax_讲义.assets/1573446050594.png" alt="1573446050594" style="zoom:50%;" />

<p>双击启动：</p>
<img src="ajax_讲义.assets/启动小黑窗服务器.png" alt="1573445984031" style="zoom:50%;" />

<p>启动小黑窗服务器的作用</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E5%90%AF%E5%8A%A8%E5%B0%8F%E9%BB%91%E7%AA%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8.png" alt="1568440063322"></p>
<h3 id="让你的网页让别人访问"><a href="#让你的网页让别人访问" class="headerlink" title="让你的网页让别人访问"></a>让你的网页让别人访问</h3><p>目标：让你的网页让别人访问</p>
<p>步骤：</p>
<ul>
<li>启动：小黑窗服务器</li>
<li>上传网页：把你的网页放在<code>public</code>目录下</li>
<li><img src="ajax_%E8%AE%B2%E4%B9%89.assets/1573522136233.png" alt="1573522136233"></li>
<li>访问：告之他人，你的网页地址：<ul>
<li>http://你的ip地址:3005/你的网页名</li>
<li>或，<a href="http://localhost:3005/文件名" target="_blank" rel="noopener">http://localhost:3005/文件名</a></li>
</ul>
</li>
</ul>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E5%B0%8F%E9%BB%91%E7%AA%97%E6%9C%8D%E5%8A%A1%E5%99%A8-%E8%AE%BF%E9%97%AE%E7%BD%91%E9%A1%B5.png" alt="1568440047436"></p>
<ul>
<li><p>让其它同学访问： 把localhost改成你的本机的ip地址(关闭本机防火墙)</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E5%B0%8F%E9%BB%91%E7%AA%97%E6%9C%8D%E5%8A%A1%E5%99%A8-%E8%AE%BF%E9%97%AE%E7%BD%91%E9%A1%B5-%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE.png" alt="1568440153144"></p>
</li>
</ul>
<h3 id="提供数据"><a href="#提供数据" class="headerlink" title="提供数据"></a>提供数据</h3><h4 id="理解接口"><a href="#理解接口" class="headerlink" title="理解接口"></a>理解接口</h4><p>在小黑窗服务器中，预置了几个可以用来操作业务，提供数据的特殊的url地址， 就是我们常说的接口。</p>
<p>作为一名前端程序员，我们日常的工作有一个重要的内容，就是调用接口。我们经常会听到类似于这样的对话。</p>
<blockquote>
<ul>
<li>开发经理问整体进度：你们组接口调通了几个？</li>
<li>前端程序员对后端程序员说：你的XXX接口有bug，我完全按接口文档上的要求调用的，老是出错。</li>
<li>开发经理问后端程序员说，我们的XX业务要给个接口给隔壁组调用哈，你跟一下哈。</li>
</ul>
</blockquote>
<p>上面几组场景中，都涉及了接口这个词， 那么接口是指什么呢？ </p>
<p>我们访问网页的过程，就是浏览器向web服务器发请求，web服务器返回请求内容的过程。我们所请求的资源可以成分成两类：</p>
<ul>
<li><p>文件：图片，css文件，html文件，视频文件等等，这是比较常见的资源，有些场合也称为静态资源。服务器处理这类请求的方式是取出文件的内容，并返回给浏览器。</p>
</li>
<li><p>代码：用服务器端语言写的一段代码，它会执行具体的业务功能，例如，用户登陆，检测用户名等。服务器处理这类请求的方式是执行这段代码，并把结果返回给浏览器。这就是我们上面谈及的接口。</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6%E4%B8%8E%E6%8E%A5%E5%8F%A3.png" alt="1568439333083"></p>
</li>
</ul>
<p>我们可以这么来理解：</p>
<ul>
<li>接口是一个网络url地址，我们通过http协议去访问这个url地址。</li>
<li>接口是由<strong>后端程序员写的一个函数</strong>，它负责接收前端传入的参数（也有可能不需要参数），进行业务处理之后，把处理结果返回给调用这个接口的请求。接口的返回值一般是纯数据。</li>
<li>接口可能有访问权限控制。</li>
<li>在前后端分离开发的背景下，我们可以理解是后端程序员写接口，前端程序员调用接口。</li>
<li>接口一般配合ajax技术来使用。</li>
</ul>
<h4 id="访问接口。"><a href="#访问接口。" class="headerlink" title="访问接口。"></a>访问接口。</h4><p>在小黑窗服务器中， 我们已经预置了一些接口，供你直接访问</p>
<p><code>1. 启动</code><br>   进入目录中，双击 “双击启动”这个文件，会自动弹出小黑窗；</p>
<p><code>2. 访问接口</code></p>
<ul>
<li>对get类型的请求，直接在地址栏中访问<ul>
<li><a href="http://localhost:3005/message/getmsg" target="_blank" rel="noopener">http://localhost:3005/message/getmsg</a></li>
</ul>
</li>
<li>具体见小黑窗服务器的中的说明。</li>
</ul>
<h2 id="JQuery中的ajax"><a href="#JQuery中的ajax" class="headerlink" title="JQuery中的ajax"></a>JQuery中的ajax</h2><h3 id="第一个ajax请求"><a href="#第一个ajax请求" class="headerlink" title="第一个ajax请求"></a>第一个ajax请求</h3><p>本节，我们将使用jQuery框架中封装好的ajax函数来向服务器发送ajax请求。带大家直接认识一下ajax请求是如何发出去的。我们重点学习$.ajax的格式，并理解回调函数的概念。</p>
<h4 id="ajax基本使用"><a href="#ajax基本使用" class="headerlink" title="$.ajax基本使用"></a>$.ajax基本使用</h4><p>前面介绍了很多概念：服务器，客户端，web服务器，http协议,ajax等等。现在我们终于可以动手写一个ajax代码了。<br><code>目标任务</code><br>通过jquery库中提供的ajax()方法，发出第一个ajax类型的http请求：获取服务器上的时间，并显示在页面上。</p>
<p><code>前提条件</code><br>web服务器上的接口已经就绪了。</p>
<p>基本流程：</p>
<ol>
<li>新建页面，引入jquery。[空白页 (public/learn/gettime.html)]</li>
<li>点击按钮，发送ajax请求。</li>
</ol>
<p>$.ajax()的基本格式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(</span><br><span class="line">  &#123;</span><br><span class="line">	 url,<span class="comment">//  '/common/getCurrentTime',</span></span><br><span class="line">     type: <span class="string">'get'</span>,<span class="comment">// post</span></span><br><span class="line">     data: &#123;<span class="attr">id</span>:<span class="number">1</span>&#125;,</span><br><span class="line">     success: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">     	<span class="built_in">console</span>.log(result)</span><br><span class="line">  	 &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>url : 表示请求的地址，可以省略域名。</li>
<li>type: 表示请求的类型，常见取值 get，post。如果不写，默认为’get’</li>
<li>data: 表示发送请求时附加的参数，如果没有参数，可省略</li>
<li>success：它是一个回调函数。当请求成功之后会自动调用这个函数，它的第一个参数是服务器端返回的数据。</li>
</ul>
<h3 id="ajax中的回调函数"><a href="#ajax中的回调函数" class="headerlink" title="ajax中的回调函数"></a>ajax中的回调函数</h3><p>回调函数(Callback Functions)是学习ajax中的一个重要的概念。<br>两层含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 1. 函数。表示它是一个函数，是可以被执行的，能做具体操作的函数。</span><br><span class="line">- 2. 回调。在某个时刻，或者某个事件发生&#96;自动去调用这个函数&#96;。</span><br></pre></td></tr></table></figure>
<p>通俗来讲，回调函数是<strong>我们自己定义的，供别人调用的函数</strong>，更具体来说，这个函数什么时间会被调用并不由我们来决定，而是”别人”来决定的。 在js中，回调函数通常用于对特定的事件或条件进行响应。 </p>
<p>我们先来看下生活中的例子：<br>陈老板安排小张去给他买咖啡，由于陈老板不知道小张具体什么时间会回来，所以，陈老板跟小张说，“你买回来之后，打电话给我。”  这个场景中就有一个回调函数的应用。</p>
<ul>
<li>回调函数 ：打电话给陈老板。</li>
<li>定义回调函数的人：陈老板。</li>
<li>调用回调函数的人：小张。</li>
<li>调用回调函数的时机：小张买好了咖啡，并回到了公司。</li>
</ul>
<p>代码示例：<br>    如下均是回调函数的使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// 这是一个匿名函数，我们自己定义的，在它网页DOM结构绘制完毕后就被调用。我们并不知道准确的调用时机。</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$(<span class="string">"#btn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// 这是一个匿名函数，我们自己定义的，在按钮点击被调用。我们并不知道用户什么时候点击按钮，所以我们不知道它准确的调用时机。</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">		 <span class="comment">// 这是一个具名函数，我们自己定义的</span></span><br><span class="line">&#125;</span><br><span class="line">$.ajax(</span><br><span class="line">  url,<span class="comment">//  '/common/getCurrentTime',</span></span><br><span class="line">  &#123;</span><br><span class="line">     type: <span class="string">'get'</span>,<span class="comment">// post</span></span><br><span class="line">     data: &#123;<span class="attr">id</span>:<span class="number">1</span>&#125;,</span><br><span class="line">     success: ok</span><br><span class="line">		 <span class="comment">//ajax请求完成之后，自动调用</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>​    一般情况下，回调函数都是匿名函数。但，也是可以给它们起名字的。</p>
<h3 id="案例-留言板"><a href="#案例-留言板" class="headerlink" title="案例-留言板"></a>案例-留言板</h3><h4 id="效果演示及分析"><a href="#效果演示及分析" class="headerlink" title="效果演示及分析"></a>效果演示及分析</h4><p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E7%95%99%E8%A8%80%E6%9D%BF-%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA.gif" alt="1568463249132"></p>
<h4 id="留言板-获取留言"><a href="#留言板-获取留言" class="headerlink" title="留言板-获取留言"></a>留言板-获取留言</h4><p>在自己的电脑上有留言板的基本代码；在远方的服务器上有留言的全部数据；我们要做的工作是就是发ajax请求，从远方的服务器上去请求数据，并显示。</p>
<p>如下：</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E7%95%99%E8%A8%80%E6%9D%BF-%E8%8E%B7%E5%8F%96%E7%95%99%E8%A8%80.png" alt="1573461784009"></p>
<p>准备工作：</p>
<ol>
<li>启动小黑窗服务器。</li>
</ol>
<p>步骤：</p>
<ol>
<li>在message.html中引入jquery.js</li>
<li>在jquery的入口函数中去请求接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span> /&gt;</span><br><span class="line">    &lt;title&gt;留言板&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;link rel="stylesheet" href="./</span>assets/bootstrap.css<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="</span>container<span class="string">"&gt;</span></span><br><span class="line"><span class="string">      &lt;h1 class="</span>display<span class="number">-1</span><span class="string">"&gt;留言板&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;hr /&gt;</span></span><br><span class="line"><span class="string">      &lt;ul id="</span>messages<span class="string">" class="</span>list-unstyled<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="</span>media<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          &lt;img class="</span>mr<span class="number">-3</span><span class="string">" src="</span>./assets/avatar.png<span class="string">" alt="</span>张三<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">          &lt;div class="</span>media-body<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;h4&gt;张三&lt;/h4&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;哈哈哈哈哈哈哈哈哈哈哈&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;2019-06-07&lt;/p&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">      &lt;hr /&gt;</span></span><br><span class="line"><span class="string">      &lt;form&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="</span>form-group<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          &lt;label for="</span>txt_name<span class="string">"&gt;称呼：&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;input class="</span>form-control<span class="string">" id="</span>txt_name<span class="string">" type="</span>text<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="</span>form-group<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          &lt;label for="</span>txt_content<span class="string">"&gt;留言：&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;textarea</span></span><br><span class="line"><span class="string">            class="</span>form-control<span class="string">"</span></span><br><span class="line"><span class="string">            id="</span>txt_content<span class="string">"</span></span><br><span class="line"><span class="string">            cols="</span><span class="number">80</span><span class="string">"</span></span><br><span class="line"><span class="string">            rows="</span><span class="number">10</span><span class="string">"</span></span><br><span class="line"><span class="string">          &gt;&lt;/textarea&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;button id="</span>btn_send<span class="string">" type="</span>button<span class="string">" class="</span>btn btn-primary<span class="string">"&gt;</span></span><br><span class="line"><span class="string">          提交</span></span><br><span class="line"><span class="string">        &lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src="</span>./jquery<span class="number">-1.8</span><span class="number">.1</span>.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">      //获取留言</span></span><br><span class="line"><span class="string">      // url:http://localhost:3005/message/getMsg</span></span><br><span class="line"><span class="string">      // 1. 在页面加载完成之后去请求</span></span><br><span class="line"><span class="string">      $(function() &#123;</span></span><br><span class="line"><span class="string">        // alert(1);</span></span><br><span class="line"><span class="string">        $.ajax('http://192.168.31.220:3005/message/getMsg', &#123;</span></span><br><span class="line"><span class="string">          type: 'get',</span></span><br><span class="line"><span class="string">          success: function(result) &#123;</span></span><br><span class="line"><span class="string">            // console.log(result);</span></span><br><span class="line"><span class="string">            // 2. 请求回来的数据渲染到页面</span></span><br><span class="line"><span class="string">            result.forEach(function(ele) &#123;</span></span><br><span class="line"><span class="string">              console.log(ele);</span></span><br><span class="line"><span class="string">              console.log(ele.name);</span></span><br><span class="line"><span class="string">              var str = `</span></span><br><span class="line"><span class="string">              &lt;li class="</span>media<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                &lt;img class="</span>mr<span class="number">-3</span><span class="string">" src="</span>./assets/avatar.png<span class="string">" alt="</span>$&#123;ele.name&#125;<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">                &lt;div class="</span>media-body<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                  &lt;h4&gt;$&#123;ele.name&#125;&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                  &lt;p&gt;$&#123;ele.content&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                  &lt;p&gt;$&#123;ele.created&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">              &lt;/li&gt;</span></span><br><span class="line"><span class="string">              `;</span></span><br><span class="line"><span class="string">              $('#messages').append(str);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>在打开网页时，就发一次ajax请求，把留言数据全显示出来。</p>
<p>接口地址：<code>http://localhost:3005/message/getmsg</code>  其中的localhost:3005是表示服务器的地址（在实际操作中可能不一样哈）</p>
<p>获取数据之后，循环：</p>
<ol>
<li>对时间戳进行转换（new Date() ).toLocaleString(）生成留言对应的html结构</li>
<li>把生成的html结构添加到页面的留言区域中</li>
</ol>
<h4 id="留言板-添加留言"><a href="#留言板-添加留言" class="headerlink" title="留言板-添加留言"></a>留言板-添加留言</h4><p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E7%95%99%E8%A8%80%E6%9D%BF-%E5%8F%91%E5%B8%83%E7%95%99%E8%A8%80%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt=""></p>
<p>实现留言的添加功能，在点击添加按钮之后：  </p>
<ol>
<li><p>收集用户的信息，并对信息进行简单的判断。</p>
<p>例如，用户名，内容不能为空.</p>
</li>
<li><p>按接口约定的格式和地址，用$.ajax发出ajax请求，并把留言信息带过去。</p>
</li>
<li><p>根据调用接口的返回结果，来决定是否要</p>
<ul>
<li>重新获取并显示留言</li>
<li>清空发布留言区域</li>
</ul>
</li>
</ol>
<p>参考代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加留言</span></span><br><span class="line"><span class="comment">// 点击添加之后：</span></span><br><span class="line">$(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 收集用户信息</span></span><br><span class="line">    <span class="keyword">var</span> name1 = $(<span class="string">'#txt_name'</span>).val().trim();</span><br><span class="line">    <span class="keyword">var</span> content1 = $(<span class="string">'#txt_content'</span>).val().trim();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 检查信息是否有空</span></span><br><span class="line">    <span class="keyword">if</span>(name1 === <span class="string">''</span> &amp;&amp; content1 === <span class="string">''</span>) &#123;</span><br><span class="line">        alert(<span class="string">'不能为空'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. 带上这些信息，发请求</span></span><br><span class="line">    $.ajax(<span class="string">'http://xxxx:3005/message/addMsg'</span>, &#123;</span><br><span class="line">        type: <span class="string">'post'</span>,</span><br><span class="line">        data: &#123; <span class="attr">name</span>: name1, <span class="attr">content</span>: content1 &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        	<span class="built_in">console</span>.log(result);</span><br><span class="line">			<span class="comment">// 4. 重新更新留言区域</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5 . 清空文本框</span></span><br><span class="line">			$(<span class="string">'#txt_name'</span>).val(<span class="string">''</span>);</span><br><span class="line">			$(<span class="string">'#txt_content'</span>).val(<span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h3><p>仿照<a href="https://account.cnblogs.com/signup" target="_blank" rel="noopener">博客园注册</a>，实现用户名占用检测效果；学习使用带参数的get请求；</p>
<p>分析一下实现的效果：</p>
<ol>
<li>用户在文本框中，输入用户名</li>
<li>当鼠标离开文本框时，去验证用户有效性。这里就涉及blur事件。</li>
<li>提示验证的结果。</li>
</ol>
<ol start="5">
<li>给出静态代码</li>
<li>分析要实现的功能;</li>
<li>介绍$.ajax的参数中的data值</li>
</ol>
<h2 id="认识ajax"><a href="#认识ajax" class="headerlink" title="认识ajax"></a>认识ajax</h2><h3 id="AJAX的应用场景"><a href="#AJAX的应用场景" class="headerlink" title="AJAX的应用场景"></a>AJAX的应用场景</h3><p>清晰表述ajax的应用场景；能够判断一个网页中是否使用了ajax技术；<br>在<code>不更新页面</code>的情况下（页面有没有更新可以观察浏览器中的后退按钮），浏览器从web服务器获取新数据以更新页面。此时就可以使用ajax技术。</p>
<p>先来对比更新和不更新页面，以分页为例</p>
<ul>
<li>大学的公告页，没有使用AJAX技术：<a href="http://www.whut.edu.cn/tzgg/" target="_blank" rel="noopener">http://www.whut.edu.cn/tzgg/</a></li>
<li>博客园的主页,   使用了AJAX技术：<a href="https://www.cnblogs.com/" target="_blank" rel="noopener">https://www.cnblogs.com/</a></li>
</ul>
<p>分页的目标是从服务器上取出新一页的数据，来更新当前的html，如果使用ajax技术的话，用户的体验会更好一些。 </p>
<p>下面通过网页中的两个案例我们来感受一下：</p>
<ul>
<li>博客页的注册页：<a href="https://account.cnblogs.com/signup" target="_blank" rel="noopener">https://account.cnblogs.com/signup</a></li>
<li>购物网站：<a href="http://www.smzdm.com" target="_blank" rel="noopener">http://www.smzdm.com</a></li>
</ul>
<h4 id="AJAX是什么"><a href="#AJAX是什么" class="headerlink" title="AJAX是什么"></a>AJAX是什么</h4><p>AJAX ，全称是：<strong>A</strong>synchronous <strong>J</strong>avaScript <strong>A</strong>nd <strong>X</strong>ml，中文名是： 异步的JavaScript和XML。它是一种创建交互式网页应用的网页开发技术。并不是一种新技术，而是一种解决方案，早在在1998年就开始使用。</p>
<p>下面对其中涉及的概念进行说明：</p>
<ol>
<li><p>async：表示异步。<br>（sync：表示同步 ）。这个单词后面会经常看到到。如何理解异步呢？ 我们可以换一个词： 异步 =====不阻塞： 浏览器在发送ajax请求数据时，并不会阻塞用户后续的操作。理解为浏览器派了一个小弟去服务器拿数据了。以用户名验证为例，你在填入用户名，并离开输入框的那一瞬间，ajax请求就发出去了，这一点可以在network面板中观察到。同时，用户不必等待本次验证的结果是否从服务器中返回，用户还可以继续做后续的操作，例如继续填写地址信息。这个就称为不阻塞。</p>
<p>那么阻塞会是什么情况：用户填入用户名，并鼠标离开输入框的那一瞬间，ajax请求就发出去了，此时界面卡顿，用户不能移动鼠标，不能输入键盘，而必须等待ajax请求回来之后，才能恢复用户的控制。显然阻塞会影响用户的使用感受。</p>
</li>
<li><p>XML表示一种数据格式<br>发ajax请求的目标是为了从web服务器拿回数据，为了方便对数据的后续操作，这个数据最好是符合某个格式规范的。在最初设计AJAX时，从服务器返回的数据是XML格式的，但后面慢慢被JSON数据格式取代了，现在的ajax请求一般求回来的数据都是json格式，但ajax的这个缩写并没有改成ajaj。</p>
</li>
</ol>
<p>更具体来说，<code>浏览器</code>通过内置对象 <code>XMLHttpRequest</code>  向服务器发起请求，并可以接收服务器返回给浏览器的数据，这一过程或实现这一过程的技术就是我们所说的 Ajax。</p>
<h4 id="AJAX的优点"><a href="#AJAX的优点" class="headerlink" title="AJAX的优点"></a>AJAX的优点</h4><p>ajax是一种解决网页局部更新的方案。它有两个明显的好处：</p>
<ol>
<li><p>局部更新，提升用户体验。</p>
</li>
<li><p>分离开发，提高开发效率。</p>
</li>
</ol>
<ul>
<li><p>局部更新，提升用户体验。</p>
</li>
<li><p>分离(前后端分离)开发，提高开发效率。</p>
<ol>
<li>后端同学提供接口。这个接口我们可以理解是一个<code>函数</code>:它的内部进行业务处理，数据库访问等等操作，并返回结果。如何去实现这函数的功能就是后端同学的任务了。</li>
<li>前端同学用ajax技术调用接口获取数据（有其特定的格式），然后再把数据转化成的图文并茂的网页。</li>
</ol>
<p><img src="ajax_%E8%AE%B2%E4%B9%89_2019_9_13_%E4%B8%8B%E5%8D%8811_39_40.assets/1568449165917.png" alt="1568449165917"></p>
</li>
</ul>
<p>同步与异步</p>
<h3 id="同步异步"><a href="#同步异步" class="headerlink" title="同步异步"></a>同步异步</h3><p>ajax中的第一个字母a表异步的意思。</p>
<h4 id="理解同步异步"><a href="#理解同步异步" class="headerlink" title="理解同步异步"></a>理解同步异步</h4><p>我们通过生活中的例子来理解。</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89_2019_9_13_%E4%B8%8B%E5%8D%8811_39_40.assets/1568474288600.png" alt="1568474288600"></p>
<p>同步方式： 一个时刻只能做一件事；</p>
<ul>
<li>我： 写代码 </li>
<li>我:   买咖啡，自己去买，花2小时</li>
<li>我：写代码</li>
</ul>
<p>异步方式：不是一件做完再做下一件，而是可能同时做多件事情；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 我： 写代码</span><br><span class="line">- 我： 买咖啡，安排别人去买，跳过这一步，我自己不做。</span><br><span class="line">- 我： 写代码</span><br></pre></td></tr></table></figure>

<p><img src="ajax_%E8%AE%B2%E4%B9%89_2019_9_13_%E4%B8%8B%E5%8D%8811_39_40.assets/1568474335912.png" alt="1568474335912"></p>
<h4 id="ajax中的同步异步"><a href="#ajax中的同步异步" class="headerlink" title="ajax中的同步异步"></a>ajax中的同步异步</h4><p>$.ajax()方法中，有一个配置项。async,它的默认值是true（如果你不设置它，它的值就是true），我们可以给它设置不同的值来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(类型，地址，是否异步)</span><br></pre></td></tr></table></figure>

<p>默认情况下，第三个参数的值是true，即启用异步模式； 如果设置为false，就是同步模式。</p>
<p>以请求黑盒服务器的接口sleep为例（这个接口已经预先写好了，直接调用即可，地址是localhost:3005/common/sleep），我们来观察效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://static.nodejs.cn/_static/img/logo.svg"</span> alt=<span class="string">""</span>&gt;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="comment">// url:'http://192.168.31.220:3005/common/gettime',</span></span><br><span class="line">    url:<span class="string">'http://192.168.31.220:3005/common/sleep'</span>,</span><br><span class="line">    type: <span class="string">'get'</span>,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(result)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>改成true和false观察效果。</p>
<p>异步执行流程：</p>
<ul>
<li>浏览器：输出1</li>
<li>浏览器：输出3</li>
<li>浏览器：ajax请求返回，执行回调函数，输出2</li>
</ul>
<p>注意：<code>异步ajax时，onload，可以写在send之后</code></p>
<p>同步执行流程：</p>
<ul>
<li><p>浏览器：输出1</p>
</li>
<li><p>浏览器：ajax请求，一直等待，回调函数输出2</p>
</li>
<li><p>浏览器：输出3</p>
</li>
</ul>
<p>设置成了同步的方式，你会在浏览器看到如下的错误信息：</p>
<p><code>[Deprecation] Synchronous XMLHttpRequest on the main thread is deprecated because of its detrimental effects to the end user&#39;s experience. For more help, check https://xhr.spec.whatwg.org/.</code></p>
<p>有几个单词：</p>
<ul>
<li>Synchronous: 同步的</li>
<li>deprecate:反对的，不赞成</li>
<li>detrimental：有害的，不利的</li>
</ul>
<p>翻译一下就是：[deprecation]由于主线程上的同步xmlhttpRequest对最终用户的体验有不利影响，因此不推荐使用它。有关更多帮助，请查看<a href="https://xhr.spec.whatwg.org/" target="_blank" rel="noopener">https://xhr.spec.whatwg.org/</a></p>
<p>上一节，我们终于发出去了第一个ajax请求，值得高兴一下。本节我们将暂停写代码的冲动，站在一个观察者的角度，分析一下ajax和http协议和服务器接口之间的关系。</p>
<h3 id="ajax与http协议"><a href="#ajax与http协议" class="headerlink" title="ajax与http协议"></a>ajax与http协议</h3><p>客户端浏览器向web服务器发请求的过程是要遵守http协议中的请求报文的格式的。 ajax请求是http请求的一种，我们可以在network面板中看到这一点。</p>
<p>访问一个使用了ajax技术的网站，打开开发者工具，切换到network面板，学习使用：</p>
<ol>
<li>清除所有请求记录</li>
<li>筛选不同类型的请求:xhr,js,css,img…</li>
<li>观察某个ajax请求的：</li>
</ol>
<ul>
<li>请求行，请求头，请求体；</li>
<li>-应行，响应求，响应体；</li>
</ul>
<ol start="4">
<li>对比普通http请求与ajax请求在响应体上的区别</li>
</ol>
<h3 id="ajax请求与普通请求"><a href="#ajax请求与普通请求" class="headerlink" title="ajax请求与普通请求"></a>ajax请求与普通请求</h3><p>ajax请求可以自己定义请求的时机，以及对请求回来的结果进行处理。</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/ajax%E8%AF%B7%E6%B1%82%E4%B8%8E%E6%99%AE%E9%80%9A%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt="1568439714165"></p>
<h3 id="ajax与接口"><a href="#ajax与接口" class="headerlink" title="ajax与接口"></a>ajax与接口</h3><ul>
<li>接口是后端同学写好的一个函数，就放在web服务器上的一段代码。这个接口一般就是被别人调用的。在前端同学通过ajax来访问这个接口地址，并获取数据。</li>
<li>ajax请求是http请求的一种，它符合http协议。前端同学使用ajax请求接口，获取数据来实现页面的局部更新。</li>
</ul>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/ajax%E8%AF%B7%E6%B1%82%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%99%AE%E9%80%9A%E6%96%B9%E5%BC%8F%E8%AF%B7%E6%B1%82%E6%8E%A5%E5%8F%A3.png" alt="1568439834264"></p>
<p>你可以使用ajax的方式来调接口，也可以使用普通的http请求来调接口（在地址栏中输入url地址）。它们的区别是:</p>
<p>ajax方式调用接口：</p>
<ul>
<li>控制何时发请求；</li>
<li>控制响应的结果</li>
</ul>
<p>普通http请求调用接口：</p>
<ul>
<li><p>不能控制何时发请求（浏览器自动控制）</p>
</li>
<li><p>不能处理响应的结果（浏览器自动控制）</p>
</li>
</ul>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/ajax%E5%92%8Chttp%E5%92%8C%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="1568433298417"></p>
<h2 id="原生ajax"><a href="#原生ajax" class="headerlink" title="原生ajax"></a>原生ajax</h2><h3 id="第一个原生ajax"><a href="#第一个原生ajax" class="headerlink" title="第一个原生ajax"></a>第一个原生ajax</h3><p>在实际的开发中，我们会直接使用如jquery这样的第三方工具库来调用ajax，而不会自己去手写一个原生的。但对于学习者来说，深入学习原生ajax能帮助我们更好的理解和掌握一些细节。</p>
<h4 id="原生ajax基本格式"><a href="#原生ajax基本格式" class="headerlink" title="原生ajax基本格式"></a>原生ajax基本格式</h4><p><code>目标</code></p>
<p>写一个原生的AJAX请求，用来获取服务器时间。</p>
<p><code>步骤4步</code></p>
<ol>
<li>new 一个xhr对象</li>
<li>设置请求信息</li>
<li>设置回调函数，处理请求结果</li>
<li>发送请求</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步： 新建一个XMLHttpRequest对象(xhr)</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步： 设置请求。 xhr.open(请求的方式, 请求的url地址);</span></span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'common/getCurrentTime'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三步：设置回调函数</span></span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'从服务器返回的数据'</span>,    xhr.responseText);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 第四步： 发送请求。 xhr.send()</span></span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<p><code>理解XMLHttpRequest对象</code></p>
<ul>
<li>ajax的功能是基于XMLHttpRequest对象来实现的。</li>
<li>它是内置对象，充当构造器使用。</li>
<li>浏览器中的network中查看 <code>xhr</code></li>
</ul>
<p>属性和方法：</p>
<ul>
<li>open()</li>
<li>send()</li>
<li>onload(function(){})</li>
<li>responseText</li>
</ul>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a></p>
<h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><h4 id="原生ajax发get请求"><a href="#原生ajax发get请求" class="headerlink" title="原生ajax发get请求"></a>原生ajax发get请求</h4><p>如果get请求需要带参数的，就附加在请求的url地址后面。<br>例如：<code>localhost:3005/getapitest?a=1b=2</code></p>
<p>格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url?参数1&#x3D;值1&amp;参数2&#x3D;值2&amp;参数3&#x3D;值3...</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>接口是否需要参数，并不是由调用接口的人（前端）决定的，而是定义这个接口的人(后端)决定的。要按照接口文档要求来使用。</li>
<li>在network中观察参数出现的位置。</li>
</ol>
<ul>
<li>在本次请求的请求行中可以看到</li>
<li>在请求的地址中也可以看到</li>
</ul>
<h4 id="原生ajax发post请求"><a href="#原生ajax发post请求" class="headerlink" title="原生ajax发post请求"></a>原生ajax发post请求</h4><p>请求post类型的接口时，有两点区别：</p>
<ol>
<li>参数写在send方法中</li>
<li>要设置请求头。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建xhr对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">//2. 初始化请求</span></span><br><span class="line">xhr.open(<span class="string">'post'</span>,服务器上接口的地址);</span><br><span class="line"><span class="comment">//3. 设置请求头，固定写法</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line"><span class="comment">//4. 监听响应的回调函数</span></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//5. 发送请求</span></span><br><span class="line">xhr.send(<span class="string">'提交给服务器数据字符串'</span>);<span class="comment">// 'a=1&amp;b=3'</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>要设置请求头</li>
<li>提交给服务器的数据写在send()中。</li>
</ul>
<h4 id="get和post的区别"><a href="#get和post的区别" class="headerlink" title="get和post的区别"></a>get和post的区别</h4><p>一个接口到底是post类型还是get类型，是由写接口的人员（后端同学）决定的；<br>在前端使用get和post接口时，我们要注意两点：</p>
<ul>
<li>get的参数是url后面可以看到</li>
<li>post的参数是通过http协议的请求体发送的</li>
<li>post请求需要设置请求头（在jquery中的使用$.ajax ()时，它已经悄悄地给我们设置了）</li>
</ul>
<h4 id="其它请求方式"><a href="#其它请求方式" class="headerlink" title="其它请求方式"></a>其它请求方式</h4><p>接口的类型不仅有get,post，还有其它的：</p>
<ul>
<li>get: 获取信息</li>
<li>post: 向服务器提供新数据</li>
<li>put：修改数据</li>
<li>delete：修改数据</li>
<li>options: 测试服务器</li>
</ul>
<p>由后端同学决定接口类型的。<br>在小黑窗服务器中，我们提供了put类型的接口。</p>
<h3 id="处理服务器的返回值"><a href="#处理服务器的返回值" class="headerlink" title="处理服务器的返回值"></a>处理服务器的返回值</h3><p>通过ajax请求接口返回的数据都是字符串。</p>
<h4 id="三种格式的字符串"><a href="#三种格式的字符串" class="headerlink" title="三种格式的字符串"></a>三种格式的字符串</h4><ul>
<li><p>普通字符串</p>
</li>
<li><p>JSON字符串</p>
</li>
<li><p>XML字符串</p>
</li>
</ul>
<h4 id="JSON字符串"><a href="#JSON字符串" class="headerlink" title="JSON字符串"></a>JSON字符串</h4><p>使用ajax请求接口时，从服务器端返回的数据在格式要统一，这样才能让不同的后端语言，不同的前端人员都能读懂，都方便操作，这里，我们约定使用JSON格式的字符串。</p>
<h5 id="如何判断返回值是JSON字符串"><a href="#如何判断返回值是JSON字符串" class="headerlink" title="如何判断返回值是JSON字符串"></a>如何判断返回值是JSON字符串</h5><p>从服务器返回的数据都是字符串格式的，如何判断数据是JSON字符串格式的？</p>
<p>方法一：在线检测</p>
<p>[在线验证json格式](<a href="http://www.bejson.com/" target="_blank" rel="noopener">http://www.bejson.com/</a>）</p>
<p>方法二：观察response</p>
<p>典型的特征是:</p>
<ul>
<li>长的和js中的对象很像</li>
<li>对象的属性使用了””</li>
</ul>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%89%B9%E7%82%B9.png" alt="1568472774409"></p>
<h5 id="JSON是什么"><a href="#JSON是什么" class="headerlink" title="JSON是什么"></a>JSON是什么</h5><p>JSON:  JavaScript Object Notation(JavaScript 对象表示法) 。 </p>
<ul>
<li>JSON 是一种通过<strong>字符串</strong>描述数据的手段，用于表示有结构的数据。</li>
<li>JSON 是轻量级的文本数据交换格式,类似 XML。</li>
<li>JSON <code>独立于编程语言</code>  （php,java,go,js 都会通过它来进行数据交流）</li>
<li>JSON 具有自我描述性，更易理解</li>
</ul>
<h5 id="JSON字符串相关的两个操作"><a href="#JSON字符串相关的两个操作" class="headerlink" title="JSON字符串相关的两个操作"></a>JSON字符串相关的两个操作</h5><ul>
<li>把JSON字符串转成具体某个编程语言中的数据格式，称为把JSON字符串转成JSON对象。</li>
<li>在某个编程语言中，把数据格式转成JSON字符串。称为把JSON对象转成JSON字符串。</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>从JSON字符串转成编程语言支持的数据</th>
<th>从数据类型转成JSON字符串</th>
</tr>
</thead>
<tbody><tr>
<td>js</td>
<td>JSON.parse()</td>
<td>JSON.stringify()</td>
</tr>
<tr>
<td>php</td>
<td>json_decode()</td>
<td>json_encode()</td>
</tr>
<tr>
<td>java</td>
<td>JSON.parseObject(),JSON.parseArray()</td>
<td>JSON.toJSONString</td>
</tr>
</tbody></table>
<p>js中提供了一个静态对象JSON来处理json（它与Math对象相似，不需要new）而是直接通过对象名.方法来调用。</p>
<h5 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify"></a>JSON.stringify</h5><p>功能：把js数据，转成JSON格式的字符串</p>
<p>格式：<code>var JSON字符串 = JSON.stringify(js数据)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">'ok'</span>, <span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">var</span> arr_jsonStr = <span class="built_in">JSON</span>.stringify(arr);</span><br><span class="line"><span class="built_in">console</span>.info(arr, <span class="keyword">typeof</span> arr);</span><br><span class="line"><span class="built_in">console</span>.info(arr_jsonStr, <span class="keyword">typeof</span> arr_jsonStr);</span><br></pre></td></tr></table></figure>




<h5 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse"></a>JSON.parse</h5><p>功能：把JSON格式的字符串，还原成JS中的数据</p>
<p>格式：<code>var JS数据 = JSON.parse(JSON字符串)</code></p>
<p>小结</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E6%8E%A5%E5%8F%A3%E4%B8%8Ejson.png" alt="1568632745070"></p>
<h4 id="XML字符串（简单了解）"><a href="#XML字符串（简单了解）" class="headerlink" title="XML字符串（简单了解）"></a>XML字符串（简单了解）</h4><p>可扩展标记语言（E<strong>x</strong>tensible Markup Language）</p>
<ul>
<li><p>XML 于 1998 年 2 月 10 日成为 <a href="https://baike.baidu.com/item/W3C" target="_blank" rel="noopener">W3C</a> 的推荐标准。AJAX（异步的javascript和XML）中的 X 就是 XML</p>
</li>
<li><p>它提供了一种描述结构数据的格式，简化了网络中<a href="https://baike.baidu.com/item/数据交换" target="_blank" rel="noopener">数据交换</a>和表示，使得代码、数据和表示分离，并作为数据交换的标准格式。</p>
</li>
<li><p>独立于编程语言的。（php,java,go,js 都会通过它来进行数据交流）</p>
</li>
</ul>
<p><code>示例</code></p>
<p>假设这个文件的名字为books.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;booklist&gt;</span><br><span class="line">&lt;book&gt;</span><br><span class="line">	&lt;author&gt;吴承恩&lt;&#x2F;author&gt;</span><br><span class="line">	&lt;name&gt;西游记&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;book&gt;</span><br><span class="line">&lt;book&gt;</span><br><span class="line">	&lt;author&gt;施耐庵&lt;&#x2F;author&gt;</span><br><span class="line">	&lt;name&gt;水浒传&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;book&gt;</span><br><span class="line">&lt;book&gt;</span><br><span class="line">	&lt;author&gt;罗贯中&lt;&#x2F;author&gt;</span><br><span class="line">	&lt;name&gt;三国演义&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;book&gt;</span><br><span class="line">&lt;book&gt;</span><br><span class="line">	&lt;author&gt;曹雪芹&lt;&#x2F;author&gt;</span><br><span class="line">	&lt;name&gt;红楼梦&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;book&gt;</span><br><span class="line">&lt;&#x2F;booklist&gt;</span><br></pre></td></tr></table></figure>

<p><code>操作</code></p>
<p>如果ajax所请求的接口，明确规定返回值是xml格式，你可以通过：</p>
<ul>
<li><p>通过xhr.responseXML来获取内容。</p>
</li>
<li><p>拿到这个内容之后，就像操作dom元素一样去访问其中的内容。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var books &#x3D; xhr.responseXML.getElementsByTagName(&#39;book&#39;)</span><br><span class="line">for (var index &#x3D; 0; index &lt; books.length; index++) &#123;</span><br><span class="line">    var element &#x3D; books[index]</span><br><span class="line">    console.info(element.getElementsByTagName(&#39;author&#39;)[0].innerHTML)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="XML-和-JSON"><a href="#XML-和-JSON" class="headerlink" title="XML 和 JSON"></a>XML 和 JSON</h4><p>相同点：</p>
<ul>
<li>都用来<code>描述数据格式</code></li>
<li>与具体的<code>编程语言无关</code></li>
<li>有自己文件格式的后缀名.xml和.json的文件</li>
</ul>
<p>区别</p>
<ul>
<li>JSON 有简易的语法（javascript基因）；XML有规范的标签（html基因）</li>
<li>JSON存储效率更高</li>
</ul>
<h3 id="ie兼容性问题"><a href="#ie兼容性问题" class="headerlink" title="ie兼容性问题"></a>ie兼容性问题</h3><h4 id="onreadystatechange及ajax状态码"><a href="#onreadystatechange及ajax状态码" class="headerlink" title="onreadystatechange及ajax状态码"></a>onreadystatechange及ajax状态码</h4><p><code>onload</code> 是 HTML5 （2014年9月）以后新增的事件，一些老的浏览器(ie6,ie7,ie8)对onload是不支持的。通过代码来验证这一点：以下代码在ie6,ie7,ie8中并不能使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'common/gettime'</span>)</span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span></span><br><span class="line"><span class="function">    //<span class="title">onload</span>在低版本的<span class="title">ie</span>中并不能使用。</span></span><br><span class="line"><span class="function">    <span class="title">alert</span>(<span class="params"><span class="string">'ok'</span></span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"><span class="title">xhr</span>.<span class="title">send</span>(<span class="params"></span>)</span></span><br></pre></td></tr></table></figure>

<p>在html5之前，获取服务器返回内容的时候使用的是 <code>onreadystatechange</code>事件，这个事件是在xhr对象状态变化时被触发，而一次请求过程中，<code>XMLHttpRequest</code>对象的状态会发生<code>多次变化</code>，也就意味着这个事件会被触发多次。</p>
<p>onreadystatechange</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'common/getCurrentTime'</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'事件被触发了'</span>xhr.readyState)</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>

<h4 id="xhr-对象的状态"><a href="#xhr-对象的状态" class="headerlink" title="xhr 对象的状态"></a><code>xhr</code> 对象的状态</h4><p>一共有5种，用<code>readyState</code>属性表示，详见下表</p>
<table>
<thead>
<tr>
<th>readyState</th>
<th>状态描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>UNSENT</td>
<td>XHR被创建，但尚未调用 <code>open()</code> 方法。</td>
</tr>
<tr>
<td>1</td>
<td>OPENED</td>
<td><code>open()</code> 方法已经被调用，建立了连接。</td>
</tr>
<tr>
<td>2</td>
<td>HEADERS_RECEIVED</td>
<td><code>send()</code> 方法已经被调用，并且已经可以获取状态行和响应头。</td>
</tr>
<tr>
<td>3</td>
<td>LOADING</td>
<td>响应体下载中， <code>responseText</code> 属性可能已经包含部分数据。</td>
</tr>
<tr>
<td><strong>4</strong></td>
<td><strong>DONE</strong></td>
<td>响应体下载完成，可以直接使用 <code>responseText</code></td>
</tr>
</tbody></table>
<p>一次正常的send()，xhr.readStatus的值的变化是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4</span><br></pre></td></tr></table></figure>



<h3 id="ie浏览器对get类型接口缓存问题"><a href="#ie浏览器对get类型接口缓存问题" class="headerlink" title="ie浏览器对get类型接口缓存问题"></a>ie浏览器对get类型接口缓存问题</h3><p>如下代码，在<code>ie</code>中运行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;button id=<span class="string">"btn"</span>&gt;获取时间&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;label for="" id="lblTimer"&gt;&lt;/</span>label&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    document.getElementById('btn').onclick = function() &#123;</span></span><br><span class="line"><span class="regexp">    var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="regexp">    xhr.open('get', 'common/g</span>etCurrentTime<span class="string">');</span></span><br><span class="line"><span class="string">    xhr.send();</span></span><br><span class="line"><span class="string">    xhr.onreadystatechange = function() &#123;</span></span><br><span class="line"><span class="string">        if (xhr.readyState == 4) &#123;</span></span><br><span class="line"><span class="string">            document.getElementById('</span>lblTimer<span class="string">').innerHTML = xhr.responseText;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一次点击获取时间，结果是正确的，而之后的结果却保持不变。</p>
<p>出现这个问题的原因：</p>
<ul>
<li>多次<strong>get请求</strong>的接口地址都一样，<strong>ie浏览器</strong>使用了第一次请求的结果来代替之后的请求结果。</li>
<li>后面的请求没有发出去。</li>
</ul>
<p>解决方式：</p>
<ul>
<li>给请求地址中补充一个无效的，随机的参数及值<ul>
<li>无效是指这个参数后端接口不需要</li>
<li>随机是为了保存每次请求的地址都不相同</li>
</ul>
</li>
</ul>
<p>示例：</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89_2019_9_13_%E4%B8%8B%E5%8D%8811_39_40.assets/1568474835105.png" alt="1568474835105"></p>
<h3 id="ajax异常处理"><a href="#ajax异常处理" class="headerlink" title="ajax异常处理"></a>ajax异常处理</h3><p>在访问接口的过程中，可能出各种异常，如接口不存在，服务器错误等。遇到这些异常时，我们可以进一步进行处理，以提高代码的健壮性。</p>
<h4 id="ajax处理"><a href="#ajax处理" class="headerlink" title="ajax处理"></a>ajax处理</h4><p>通过状态码来处理不同的异常情况。</p>
<p>典型的有:404错误, 500错误。</p>
<h3 id="FormData对象"><a href="#FormData对象" class="headerlink" title="FormData对象"></a>FormData对象</h3><p>（<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener">官方api参考</a>）</p>
<p>FormData：表单数据。它是用来处理html中与表单数据相关的操作的内置对象。</p>
<p>一个典型的ajax的使用过程， 一般是：</p>
<ol>
<li><strong>收集用户的输入的参数</strong></li>
<li>按接口文档的要求把参数传递到后端接口</li>
<li>根据后端接口的返回值来局部更新页面。</li>
</ol>
<p>以上三个步骤中，我们可以使用FormData来帮助我们收集用户信息这个部分。 </p>
<p>除此之外，它还有一个典型的应用场景:<code>上传文件</code></p>
<h4 id="快速获取表单中的元素值"><a href="#快速获取表单中的元素值" class="headerlink" title="快速获取表单中的元素值"></a>快速获取表单中的元素值</h4><p>假设有一个静态页面如下，它有三项信息要收集起来：姓名，密码，性别。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"myform"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"userName"</span> <span class="attr">name</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"userPassword"</span> <span class="attr">name</span>=<span class="string">"userPassword"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">id</span>=<span class="string">"genderMale"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"userGender"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">value</span>=<span class="string">"male"</span></span></span><br><span class="line"><span class="tag">               /&gt;</span>男</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">id</span>=<span class="string">"genderFemale"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"userGender"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">value</span>=<span class="string">"female"</span></span></span><br><span class="line"><span class="tag">               /&gt;</span>女</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">type</span>=<span class="string">"button"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击注册按钮之后，我们会把这三项数据发送给后端口请口，这里我们的重点不是实现注册功能，我们把注意力放在如何去收集这三项信息上。</p>
<ul>
<li>手动一个一个收集，再拼接</li>
<li>使用formData收集</li>
</ul>
<p><code>不用FormData</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//收集用户信息</span></span><br><span class="line">    <span class="keyword">var</span> userName = <span class="built_in">document</span>.getElementById(<span class="string">'userName'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> userPassword = <span class="built_in">document</span>.getElementById(<span class="string">'userPassword'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> userGender = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.getElementById(<span class="string">'genderMale'</span>).checked) &#123;</span><br><span class="line">        userGender = <span class="string">'male'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.getElementById(<span class="string">'genderFemale'</span>).checked) &#123;</span><br><span class="line">        userGender = <span class="string">'famale'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.info(userName, userPassword, userGender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过post传值</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.responseType = <span class="string">'json'</span>;</span><br><span class="line">    xhr.open(<span class="string">'post'</span>, <span class="string">'common/postapitest'</span>);</span><br><span class="line">    xhr.setRequestHeader(</span><br><span class="line">        <span class="string">'Content-type'</span>,</span><br><span class="line">        <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">    );</span><br><span class="line">    xhr.send(</span><br><span class="line">        <span class="string">`userName=<span class="subst">$&#123;userName&#125;</span>&amp;userPassword=<span class="subst">$&#123;userPassword&#125;</span>&amp;userGender=<span class="subst">$&#123;userGender&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.info(xhr.response);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>使用FormData</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//收集用户信息</span></span><br><span class="line">    <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData(<span class="built_in">document</span>.getElementById(<span class="string">'myform'</span>));</span><br><span class="line">    <span class="comment">// 通过post传值</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.responseType = <span class="string">'json'</span>;</span><br><span class="line">    xhr.open(<span class="string">'post'</span>, <span class="string">'common/postapitest'</span>);</span><br><span class="line">    <span class="comment">// 不用设置请求头 </span></span><br><span class="line">    <span class="comment">// xhr.setRequestHeader(</span></span><br><span class="line">    <span class="comment">//   'Content-type',</span></span><br><span class="line">    <span class="comment">//   'application/x-www-form-urlencoded'</span></span><br><span class="line">    <span class="comment">// );</span></span><br><span class="line">    xhr.send(fd);</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.info(xhr.response);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>要注意：</p>
<ul>
<li><p>FormData对象内部有一个键值对集合，其中的键名就是表单元素的name属性名，而值就是这个表单元素当前的值。</p>
</li>
<li><p>在设置表单元素的name属性值时，要最好与后端接口中需要的参数名一一对应起来。</p>
</li>
<li><p>如果传递的参数是formdata对象，则不需要需要单独设置请求头content-type:application/x-www-form-urlencoded,原因是：它会设置自己的请求头 content-type: application/json。</p>
</li>
</ul>
<h4 id="FormData对象的api"><a href="#FormData对象的api" class="headerlink" title="FormData对象的api"></a>FormData对象的api</h4><p>参考地址：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/FormData</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fd = <span class="keyword">new</span> Formdata();</span><br><span class="line">fd.append(key,value);</span><br><span class="line"><span class="comment">// 向 FormData 中添加新的属性值，如果FormData 对应的属性值存在则覆盖原值，否则新增一项属性值。</span></span><br><span class="line">fd.delete(key);</span><br><span class="line"><span class="comment">// 从 FormData 对象里面删除一个键值对。</span></span><br><span class="line"></span><br><span class="line">fd.get(key)</span><br><span class="line"><span class="comment">//返回在 FormData 对象中与给定键关联的第一个值。</span></span><br><span class="line"></span><br><span class="line">fd.has(key)</span><br><span class="line"><span class="comment">//返回一个布尔值表明 FormData 对象是否包含某些键。</span></span><br><span class="line">fd.set(key,value)</span><br><span class="line"><span class="comment">//给 FormData 设置属性值，如果FormData 对应的属性值存在则覆盖原值，否则新增一项属性值。</span></span><br></pre></td></tr></table></figure>



<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>文件上传是一个非常常见的需求，例如，用户注册时，提交自己的头像信息。小黑窗服务器已经预置了一个接口可以用来上传文件。接口的地址是：<code>formdata/upload</code></p>
<p>使用这个接口有两点注意：</p>
<ul>
<li>这个接口只能接收formdata对象，并且你上传的文件信息必须是保存在名为<code>file</code>的键中。也就是说<strong>input 的name值必须是file</strong> 。 </li>
<li>小黑窗服务器的根目录下，必须要放置一个<code>upload</code>文件夹。这个文件夹就是用来保存上传的文件的。</li>
</ul>
<p>核心代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;h1&gt;FormData文件上传&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;form id="myForm"&gt;</span></span><br><span class="line"><span class="regexp">       &lt;label for=""&gt;请选择你要上传的文件&lt;/</span>label&gt;</span><br><span class="line">       &lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">     &lt;button id="btn"&gt;上传&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">   document.getElementById('btn').onclick = function() &#123;</span></span><br><span class="line"><span class="regexp">     var fd = new FormData(document.getElementById('myForm'));</span></span><br><span class="line"><span class="regexp">     var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="regexp">     xhr.open('post', 'formdata/u</span>pload<span class="string">');</span></span><br><span class="line"><span class="string">     xhr.onload = function() &#123;</span></span><br><span class="line"><span class="string">       console.info(xhr.responseText);</span></span><br><span class="line"><span class="string">     &#125;;</span></span><br><span class="line"><span class="string">     xhr.send(fd);</span></span><br><span class="line"><span class="string">   &#125;;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="onprogress事件"><a href="#onprogress事件" class="headerlink" title="onprogress事件"></a>onprogress事件</h4><p>我们在上传文件时，还可以使用xhr.upload.onprogress来展示上传进度条的效果。</p>
<p>原理：</p>
<ul>
<li>xhr对象中有一个子对象upload，upload对象中有一个事件 onprogress。</li>
<li>onprogress事件大约每100ms触发一次，其回调函数第一个参数是一个事件对象，这个事件对象中有两个属性 loaded 和 total<ul>
<li>loaded：表示已上传文件的大小</li>
<li>total： 表示文件总大小</li>
</ul>
</li>
</ul>
<p>实现思路：</p>
<ul>
<li><p>制作进度条。</p>
<ul>
<li><p>自己做。使用两层嵌套的div即可：第一层是进度条的外边框，第二层才是进度条。</p>
</li>
<li><p>使用bootstrap[<a href="http://bs4.ntp.org.cn/pages/components.html#striped]" target="_blank" rel="noopener">http://bs4.ntp.org.cn/pages/components.html#striped]</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;progress&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;progress-bar progress-bar-striped&quot; role&#x3D;&quot;progressbar&quot; style&#x3D;&quot;width: 10%&quot; aria-valuenow&#x3D;&quot;10&quot; aria-valuemin&#x3D;&quot;0&quot; aria-valuemax&#x3D;&quot;100&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>每次onprogress事件触发时：</p>
<ul>
<li>计算当前已上传文件大小的百分比</li>
<li>根据百分比去重绘进度条长度</li>
</ul>
</li>
</ul>
<p>核心代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&#39;btn&#39;).onclick &#x3D; function() &#123;</span><br><span class="line">    var innerDom &#x3D; document.getElementById(&#39;inner&#39;);</span><br><span class="line">    var fd &#x3D; new FormData(document.getElementById(&#39;myForm&#39;));</span><br><span class="line">    var xhr &#x3D; new XMLHttpRequest();</span><br><span class="line">    xhr.open(&#39;post&#39;, &#39;formdata&#x2F;upload&#39;);</span><br><span class="line">	xhr.onload &#x3D; function() &#123;</span><br><span class="line">        console.info(xhr.responseText);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.upload.onprogress &#x3D; function(ev) &#123;</span><br><span class="line">        console.info(Date.now());</span><br><span class="line">        &#x2F;&#x2F; 已上传 &#x2F; 总大小</span><br><span class="line">        console.info((ev.loaded &#x2F; ev.total) * 100 + &#39;%&#39;);</span><br><span class="line">        &#x2F;&#x2F; 设置百分比值</span><br><span class="line">        innerDom.style.width &#x3D; (ev.loaded &#x2F; ev.total) * 100 + &#39;%&#39;;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(fd);</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="原生ajax封装"><a href="#原生ajax封装" class="headerlink" title="原生ajax封装"></a>原生ajax封装</h2><p>封装的目标：$.ajax({url,type,data,success:function(){} })</p>
<h4 id="封装1-命名"><a href="#封装1-命名" class="headerlink" title="封装1-命名"></a>封装1-命名</h4><h4 id="封装2-提取type参数"><a href="#封装2-提取type参数" class="headerlink" title="封装2-提取type参数"></a>封装2-提取type参数</h4><h4 id="封装3-提取url和data"><a href="#封装3-提取url和data" class="headerlink" title="封装3-提取url和data"></a>封装3-提取url和data</h4><h4 id="封装4-处理post请求"><a href="#封装4-处理post请求" class="headerlink" title="封装4-处理post请求"></a>封装4-处理post请求</h4><h4 id="封装5-处理回调函数"><a href="#封装5-处理回调函数" class="headerlink" title="封装5-处理回调函数"></a>封装5-处理回调函数</h4><h2 id="第7章-主流ajax库"><a href="#第7章-主流ajax库" class="headerlink" title="第7章 主流ajax库"></a>第7章 主流ajax库</h2><p>在实际开发中，我们一般会采用已经封装好的ajax库来帮助我们去处理ajax请求。</p>
<ul>
<li>jquery</li>
<li>axios</li>
</ul>
<h3 id="第1节-jquery"><a href="#第1节-jquery" class="headerlink" title="第1节 jquery"></a>第1节 jquery</h3><h4 id="ajax"><a href="#ajax" class="headerlink" title="$.ajax"></a>$.ajax</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url:&#39;&#39;,</span><br><span class="line">  type: &#39;get&#39;,</span><br><span class="line">  data: &#123; id: 1 &#125;,</span><br><span class="line">  beforeSend: function (xhr) &#123;</span><br><span class="line">    console.log(&#39;before send&#39;)</span><br><span class="line">  &#125;,</span><br><span class="line">  success: function (data) &#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">  &#125;,</span><br><span class="line">  error: function (xhr) &#123;</span><br><span class="line">    console.log(xhr)</span><br><span class="line">  &#125;,</span><br><span class="line">  complete: function (xhr) &#123;</span><br><span class="line">    console.log(&#39;request completed&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>参数介绍 <a href="http://jquery.cuishifeng.cn/jQuery.Ajax.html" target="_blank" rel="noopener">官网地址</a>：</p>
<ul>
<li><p>url：请求地址</p>
</li>
<li><p>type / method：请求方法，默认为 <code>get</code></p>
</li>
<li><p>data：需要传递到服务端的数据。字符串和对象均可。如果是对象会自动拼接成查询字符串</p>
</li>
<li><p>success：请求成功之后触发</p>
</li>
<li><p>cache: 解决ie浏览器的缓存问题。默认为true，表示缓存。  cache: false 不缓存，会在地址后面补一个_参数。</p>
</li>
<li><p>contentType：发送参数到服务器时，采用的编码类型，默认 <code>application/x-www-form-urlencoded</code></p>
</li>
<li><p>timeout：本次请求最大长时间。以毫秒为单位。如果请求超时，会触发error。</p>
</li>
<li><p>beforeSend：请求发起之前触发</p>
</li>
<li><p>complete：请求完成触发（不管成功与否）</p>
</li>
<li><p>error：function(xhr,)请求失败触发。如果接口返回500错误，它会被触发。</p>
</li>
<li><p>processData:boolean。是否让jquery帮助处理data参数</p>
</li>
</ul>
<h4 id="ajax方法的简便用法"><a href="#ajax方法的简便用法" class="headerlink" title="$.ajax方法的简便用法"></a>$.ajax方法的简便用法</h4><ul>
<li>$.get()  </li>
<li>$.post()</li>
<li>$.getJSON()</li>
</ul>
<h5 id="get的格式"><a href="#get的格式" class="headerlink" title="$.get的格式"></a>$.get的格式</h5><p>对于比较简单的get请求，jquery提供了一个快捷方法$.get()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="keyword">get</span>(url,[,data][,success]);</span><br><span class="line">参数：</span><br><span class="line"> - url     ：字符串方式。指要请求的 URL 地址。</span><br><span class="line"> - data    : js对象，或者字符串方式。 可选的。 指发请求带给服务器的信息。</span><br><span class="line"> - success : function(result)&#123;&#125; 。 可选的。它是一个回调函数，当请求成功时被自动调用，它的第一个参数是从服务器返回的数据。</span><br></pre></td></tr></table></figure>

<h5 id="post的格式"><a href="#post的格式" class="headerlink" title="$.post的格式"></a>$.post的格式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.post(url,[,data][,success]);</span><br><span class="line">参数：</span><br><span class="line">- url     ：字符串方式。指要请求的 URL 地址。</span><br><span class="line">- data    : js对象，或者字符串方式。 可选的。 指发请求带给服务器的信息。</span><br><span class="line">- success : function(result)&#123;&#125; 。 可选的。它是一个回调函数，当请求成功时被自动调用，它的第一个参数是从服务器返回的数据。</span><br></pre></td></tr></table></figure>

<h5 id="getJSON"><a href="#getJSON" class="headerlink" title="$.getJSON"></a>$.getJSON</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.getJSON(url,[,data][,success]);</span><br><span class="line">参数：</span><br><span class="line"> - url     ：字符串方式。指要请求的 URL 地址。</span><br><span class="line"> - data    : js对象，或者字符串方式。 可选的。 指发请求带给服务器的信息。</span><br><span class="line"> - success : <span class="function"><span class="keyword">function</span>(<span class="params">json</span>)</span>&#123;&#125; 。它是一个回调函数，当请求成功时被自动调用，它的参数是从服务器返回的<span class="built_in">JSON</span>数据。</span><br></pre></td></tr></table></figure>

<h3 id="axios库"><a href="#axios库" class="headerlink" title="axios库"></a>axios库</h3><p>jquery中封装了ajax功能，但是它的体积比较大。如果我们只希望使用ajax功能，而不需要dom操作的话，我们可以选择使用axios库。</p>
<ul>
<li>它比jquery的体积小的多，适用于只需要ajax请求的业务场景；</li>
<li>后期学习前端框架时也会用到；</li>
</ul>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><p>通过官网查看其使用方法。中文网站：&lt;<a href="http://www.axios-js.com/zh-cn/docs/" target="_blank" rel="noopener">http://www.axios-js.com/zh-cn/docs/</a></p>
<p>与jquery一样，要使用它，必须先引入这个文件。然后就可以按如下的格式去使用了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取服务器的返回值</span></span><br><span class="line">axios.get(<span class="string">'/common/getapitest?id=123'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// res 就是本次请求的信息</span></span><br><span class="line">    <span class="built_in">console</span>.info(res);</span><br><span class="line">    <span class="comment">// 获取 从服务器返回的数据</span></span><br><span class="line">    <span class="built_in">console</span>.info(res.data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">'/common/getapitest'</span>, &#123; <span class="attr">params</span>: &#123; <span class="attr">id</span>: <span class="number">123</span>, <span class="attr">name</span>: <span class="string">'jake'</span> &#125; &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// res 就是本次请求的信息</span></span><br><span class="line">    <span class="built_in">console</span>.info(res);</span><br><span class="line">    <span class="comment">// 获取 从服务器返回的数据</span></span><br><span class="line">    <span class="built_in">console</span>.info(res.data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// post请求，不带参数</span></span><br><span class="line">axios.post(<span class="string">'/common/postapitest'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.info(res.data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// post请求，带参数</span></span><br><span class="line"><span class="comment">// var params = new URLSearchParams();</span></span><br><span class="line"> <span class="comment">// params.append('参数名', '值');</span></span><br><span class="line"> <span class="comment">// params.append('a', '123');</span></span><br><span class="line"><span class="comment">// axios.post('/common/postapitest', params)</span></span><br><span class="line"></span><br><span class="line">axios.post(<span class="string">'/common/postapitest'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span>, <span class="attr">name</span>: <span class="string">'jake'</span> &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.info(res.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>它对返回值做了一些封装，需要进一步进行解析。</li>
</ul>
<h2 id="案例-会员管理系统"><a href="#案例-会员管理系统" class="headerlink" title="[案例]会员管理系统"></a>[案例]会员管理系统</h2><h3 id="演示及分析"><a href="#演示及分析" class="headerlink" title="演示及分析"></a>演示及分析</h3><h3 id="显示会员列表"><a href="#显示会员列表" class="headerlink" title="显示会员列表"></a>显示会员列表</h3><p>基本思路：</p>
<ul>
<li><p>发ajax请求；</p>
</li>
<li><p>数据回来之后，使用字符串模板来封装结构</p>
</li>
</ul>
<p>实现步骤：</p>
<ul>
<li>引入jquery.js</li>
<li>在网页打开时，发请求。</li>
<li>数据回来之后，生成对应的成员。</li>
</ul>
<h3 id="查看会员详情"><a href="#查看会员详情" class="headerlink" title="查看会员详情"></a>查看会员详情</h3><p>从主页中点击超链接进行跳转(index.html —&gt; detail.html)</p>
<ul>
<li>整体分析<ul>
<li>流程分析</li>
<li>接口测试</li>
</ul>
</li>
<li>从地址url中取出id值</li>
<li>发送请求，更新页面元素</li>
</ul>
<h3 id="删除会员"><a href="#删除会员" class="headerlink" title="删除会员"></a>删除会员</h3><p>基本思路：</p>
<ul>
<li><p>获取要删除的会员的编号；</p>
</li>
<li><p>调用接口去实现删除功能； </p>
</li>
</ul>
<p>基本步骤：</p>
<ul>
<li>给每个删除链接上，补充成员id。</li>
<li>给每个删除链接上，补充’href=”javascript:;”‘，这样可以阻止默认的跳转事件。</li>
<li>给弹出框中的删除按钮添加点击事件<ul>
<li>获取上面的label中的id。</li>
<li>发ajax请求,进行删除</li>
</ul>
</li>
</ul>
<p>重点代码：</p>
<ol>
<li>取消a标签的跳转动作</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascirpt:;"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>添加事件委托</p>
<p>问题描述：元素是动态生成的，无法直接给元素添加点击事件。</p>
<p>解决方法：给其父元素添加事件监听。由于元素上的事件具有冒泡特性：在子元素上的点击事件最终也会冒泡到父元素上。所以可以直接在父元素上监听。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#parent"</span>).on(<span class="string">"click"</span>,<span class="string">".son"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="添加会员"><a href="#添加会员" class="headerlink" title="添加会员"></a>添加会员</h3><h4 id="文件控件"><a href="#文件控件" class="headerlink" title="文件控件"></a>文件控件</h4><p>使用文件控件来上传头像文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 只允许看到jpeg图片</span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; accept&#x3D;&quot;image&#x2F;jpeg&quot; &#x2F;&gt;</span><br><span class="line">&#x2F;&#x2F; 只允许看到png图片</span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; accept&#x3D;&quot;image&#x2F;png&quot; &#x2F;&gt;</span><br><span class="line">&#x2F;&#x2F; 允许所有的图片</span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; accept&#x3D;&quot;image&#x2F;*&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>其它类型</p>
<table>
<thead>
<tr>
<th><strong>文件类型</strong></th>
<th><strong>accept属性值</strong></th>
<th><strong>类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td>*.asf</td>
<td>allpication/vnd.ms-asf</td>
<td>Advanced Streaming Format</td>
</tr>
<tr>
<td>*.au</td>
<td>audio/basic</td>
<td>AU Audio</td>
</tr>
<tr>
<td>*.css</td>
<td>text/css</td>
<td>Cascading Style Sheets</td>
</tr>
<tr>
<td>*.csv</td>
<td>text/csv</td>
<td>Comma Separated Values</td>
</tr>
<tr>
<td>*.doc</td>
<td>application/msword</td>
<td>MS Word Document</td>
</tr>
<tr>
<td>*.dot</td>
<td>application/msword</td>
<td>MS Word Template</td>
</tr>
<tr>
<td>*.dwg</td>
<td>image/vnd.dwg</td>
<td>AutoCAD Drawing Database</td>
</tr>
<tr>
<td>*.dxf</td>
<td>image/vnd.dxf</td>
<td>AutoCAD Drawing Interchange Format</td>
</tr>
<tr>
<td>*.gif</td>
<td>image/gif</td>
<td>Graphic Interchange Format</td>
</tr>
<tr>
<td>*.htm</td>
<td>text/html</td>
<td>HyperText Markup Language</td>
</tr>
<tr>
<td>*.html</td>
<td>text/html</td>
<td>HyperText Markup Language</td>
</tr>
<tr>
<td>*.jp2</td>
<td>image/jp2</td>
<td>JPEG-2000</td>
</tr>
<tr>
<td>*.jpe</td>
<td>image/jpeg</td>
<td>JPEG</td>
</tr>
<tr>
<td>*.jpeg</td>
<td>image/jpeg</td>
<td>JPEG</td>
</tr>
<tr>
<td>*.jpg</td>
<td>image/jpeg</td>
<td>JPEG</td>
</tr>
<tr>
<td>*.js</td>
<td>text/javascript, application/javascript</td>
<td>JavaScript</td>
</tr>
<tr>
<td>*.json</td>
<td>application/json</td>
<td>JavaScript Object Notation</td>
</tr>
<tr>
<td>*.mp2</td>
<td>audio/mpeg, video/mpeg</td>
<td>MPEG Audio/Video Stream, Layer II</td>
</tr>
<tr>
<td>*.mp3</td>
<td>audio/mpeg</td>
<td>MPEG Audio Stream, Layer III</td>
</tr>
<tr>
<td>*.mp4</td>
<td>audio/mp4, video/mp4</td>
<td>MPEG-4 Audio/Video</td>
</tr>
<tr>
<td>*.mpeg</td>
<td>video/mpeg</td>
<td>MPEG Video Stream, Layer II</td>
</tr>
<tr>
<td>*.mpg</td>
<td>video/mpeg</td>
<td>MPEG Video Stream, Layer II</td>
</tr>
<tr>
<td>*.mpp</td>
<td>application/vnd.ms-project</td>
<td>MS Project Project</td>
</tr>
<tr>
<td>*.ogg</td>
<td>application/ogg, audio/ogg</td>
<td>Ogg Vorbis</td>
</tr>
<tr>
<td>*.pdf</td>
<td>application/pdf</td>
<td>Portable Document Format</td>
</tr>
<tr>
<td>*.png</td>
<td>image/png</td>
<td>Portable Network Graphics</td>
</tr>
<tr>
<td>*.pot</td>
<td>application/vnd.ms-powerpoint</td>
<td>MS PowerPoint Template</td>
</tr>
<tr>
<td>*.pps</td>
<td>application/vnd.ms-powerpoint</td>
<td>MS PowerPoint Slideshow</td>
</tr>
<tr>
<td>*.ppt</td>
<td>application/vnd.ms-powerpoint</td>
<td>MS PowerPoint Presentation</td>
</tr>
<tr>
<td>*.rtf</td>
<td>application/rtf, text/rtf</td>
<td>Rich Text Format</td>
</tr>
<tr>
<td>*.svf</td>
<td>image/vnd.svf</td>
<td>Simple Vector Format</td>
</tr>
<tr>
<td>*.tif</td>
<td>image/tiff</td>
<td>Tagged Image Format File</td>
</tr>
<tr>
<td>*.tiff</td>
<td>image/tiff</td>
<td>Tagged Image Format File</td>
</tr>
<tr>
<td>*.txt</td>
<td>text/plain</td>
<td>Plain Text</td>
</tr>
<tr>
<td>*.wdb</td>
<td>application/vnd.ms-works</td>
<td>MS Works Database</td>
</tr>
<tr>
<td>*.wps</td>
<td>application/vnd.ms-works</td>
<td>Works Text Document</td>
</tr>
<tr>
<td>*.xhtml</td>
<td>application/xhtml+xml</td>
<td>Extensible HyperText Markup Language</td>
</tr>
<tr>
<td>*.xlc</td>
<td>application/vnd.ms-excel</td>
<td>MS Excel Chart</td>
</tr>
<tr>
<td>*.xlm</td>
<td>application/vnd.ms-excel</td>
<td>MS Excel Macro</td>
</tr>
<tr>
<td>*.xls</td>
<td>application/vnd.ms-excel</td>
<td>MS Excel Spreadsheet</td>
</tr>
<tr>
<td>*.xlt</td>
<td>application/vnd.ms-excel</td>
<td>MS Excel Template</td>
</tr>
<tr>
<td>*.xlw</td>
<td>application/vnd.ms-excel</td>
<td>MS Excel Workspace</td>
</tr>
<tr>
<td>*.xml</td>
<td>text/xml, application/xml</td>
<td>Extensible Markup Language</td>
</tr>
<tr>
<td>*.zip</td>
<td>application/zip</td>
<td>Compressed Archive</td>
</tr>
</tbody></table>
<h4 id="本地图片预览"><a href="#本地图片预览" class="headerlink" title="本地图片预览"></a>本地图片预览</h4><p>文件控件选中图片后，文件控件中会保存图片信息它的files属性中。files属性是一个数组，如果只选中了一张图片，这张图片就放在files[0]中，如选了多张图片，则类似后推。</p>
<p>对于这些文件信息（本例中的文件就是用户选中的图片），我们通过<code>window.URL.createObjectURL()</code>来创建一个临时的路径，这个路径可能是像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blob:http:<span class="comment">//localhost:3005/fc517910-1300-44f3-a6e8-d52f56f34e4e</span></span><br></pre></td></tr></table></figure>

<p>你可以通过打一个新的浏览器窗口，并在地址栏中输入这个路径来访问这张图片。注意，它只是临时的，如果你关闭了选中图片的网页，这张图片也将会不可访问。</p>
<p>现在，我们拿到这个临时的url赋值给某一个img标签的src即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input_avatar就是file控件的内容发生变化执行</span></span><br><span class="line">$(<span class="string">'#input_avatar'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log('xxx');</span></span><br><span class="line">    <span class="comment">// 如果没有选择文件，返回</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.files[<span class="number">0</span>]) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = URL.createObjectURL(<span class="keyword">this</span>.files[<span class="number">0</span>]);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 设置图片的src</span></span><br><span class="line">    $(<span class="string">'#avatar'</span>).attr(<span class="string">'src'</span>, url);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="整体实现"><a href="#整体实现" class="headerlink" title="整体实现"></a>整体实现</h4><p>这里的上传不是一个简单的post请求，它其中包含了文件的上传，我们使用FormData对象来上传图片，会员名，会员说明，并使用$.ajax()方法来实现上传操作。</p>
<p>与原生的ajax传递formdata对象不同，在使用$.ajax()上传formdata对象时，要额外补充两个设置：</p>
<ol>
<li>processData:false</li>
</ol>
<p>不需要jquery去处理上传数据</p>
<ol start="2">
<li>contentType:false</li>
</ol>
<p>jquery会自动给post请求设置请求头，content-type:’application-x-www-form-urlencoded’。这种做法在大多数情况下，都是对的，但是，如果提交的数据是formdata，就不需要去设置了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 添加会员</span></span><br><span class="line"><span class="comment">// 2.1 给按钮注册事件  注意，这个是提交按钮</span></span><br><span class="line">$(<span class="string">'#btn_add'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.2 获取用户输入的内容，还有用户选择的文件</span></span><br><span class="line">    <span class="comment">// 2.3 FormData  设置请求体，可以提交二进制数据，可以上传文件</span></span><br><span class="line">    <span class="comment">//     xhr.send(formData);</span></span><br><span class="line">    <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData($(<span class="string">"#myform"</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.4 发送请求，添加数据</span></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">'post'</span>,</span><br><span class="line">        url: <span class="string">'/member/add'</span>,</span><br><span class="line">        data: fd,</span><br><span class="line">        processData: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// 不设置content-type，而是当设置了formdata上传文件的时候，xhr对象会自动把content-type设置为multipart/form-data;</span></span><br><span class="line">        contentType: <span class="literal">false</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 判断添加是否成功...</span></span><br><span class="line">            <span class="comment">// 2.5 跳转回首页</span></span><br><span class="line">            location.href = <span class="string">'/'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="下拉加载"><a href="#下拉加载" class="headerlink" title="下拉加载"></a>下拉加载</h3><ul>
<li><p>分析加载数据的时机</p>
<p><img src="ajax_%E8%AE%B2%E4%B9%89.assets/%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E4%B8%8B%E6%8B%89%E5%8A%A0%E8%BD%BD%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="1568469077394"></p>
</li>
<li><p>基本完成</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">全局变量来记录最大的last值</span><br><span class="line">&#x2F;&#x2F; 注册滚动的事件</span><br><span class="line">$(window).scroll(function () &#123;</span><br><span class="line">   &#x2F;&#x2F; 判断当前是否正在加载数据，如果正在加载数据，就不要再次发送请求了</span><br><span class="line">   if (loading) return;</span><br><span class="line">   &#x2F;&#x2F; 获取文档的高度</span><br><span class="line">  var documentH &#x3D; $(document).height();</span><br><span class="line">  &#x2F;&#x2F; 获取浏览器窗口的高度</span><br><span class="line">  var windowH &#x3D; $(window).height();</span><br><span class="line">  &#x2F;&#x2F; 文档滚动出去的距离</span><br><span class="line">  var scrollTop &#x3D; $(document).scrollTop();</span><br><span class="line">  &#x2F;&#x2F; 判断当前滚动条距离底部的距离是否 &lt;&#x3D; 100，加载更多数据</span><br><span class="line">  if (documentH - windowH - scrollTop &lt;&#x3D; 100) &#123;</span><br><span class="line">    &#x2F;&#x2F; 加载更多</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>优化<ul>
<li>不要重复发请求</li>
<li>loading效果</li>
<li>数据全部加载完成之后的处理</li>
</ul>
</li>
</ul>

      
       
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>

<!-- 
<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Ajax</p>
    
    <p><span class="copy-title">本文作者:</span><a  title="wangweilin">wangweilin</a></p>
    <p><span class="copy-title">发布时间:</span>2017-05-18, 00:00:00</p>
    <p><span class="copy-title">最后更新:</span>2022-03-27, 17:16:57</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2017/05/18/7.ajax/" title="Ajax">http://yoursite.com/2017/05/18/7.ajax/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>
 -->




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2017-2020 Wanglog</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': [],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
